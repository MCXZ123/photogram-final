<h1><%= @user.username %>'s Profile</h1>

<% if current_user && current_user != @user %>
  <% existing_request = current_user.sent_follow_requests.find_by(recipient: @user) %>

  <% if existing_request.nil? %>
    <%= form_with model: FollowRequest.new, local: true do |form| %>
      <%= form.hidden_field :recipient_id, value: @user.id %>
      <%= form.submit "Follow" %>
    <% end %>

  <% elsif existing_request.status == "pending" %>
    <p>Request sent.</p>
    <%= button_to "Cancel", follow_request_path(existing_request), method: :delete %>

  <% elsif existing_request.status == "accepted" %>
    <%= button_to "Unfollow", follow_request_path(existing_request), method: :delete %>
  <% end %>
<% end %>

<% if current_user == @user && @user.private? %>
  <h2>Pending Requests</h2>
  <% @user.received_follow_requests.where(status: "pending").each do |request| %>
    <p>
      <%= request.sender.username %>
      <%= button_to "Accept", accept_follow_request_path(request), method: :post %>
      <%= button_to "Reject", reject_follow_request_path(request), method: :post %>
    </p>
  <% end %>
<% end %>
